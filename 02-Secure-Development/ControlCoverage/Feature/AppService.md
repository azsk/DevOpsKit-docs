<H2>AppService</H2><table><tr><th align="left">Description & Rationale</th><th align="left">Severity</th><th align="left">Automated</th><th align="left">Fix Script</th></tr><tr><td><b>All users/identities must be granted minimum required permissions using Role Based Access Control (RBAC)</b><br/>Granting minimum access by leveraging RBAC feature ensures that users are granted just enough permissions to perform their tasks. This minimizes exposure of the resources in case of user/service account compromise.</td><td>Medium</td><td>Yes</td><td>No</td></tr><tr><td><b>Custom domain with SSL binding must be configured for App Service</b><br/>Use of custom domain protects a web application from common attacks such as phishing, session hijacking and other DNS-related attacks.</td><td>Medium</td><td>Yes</td><td>No</td></tr><tr><td><b>App Service must authenticate users using Azure Active Directory backed credentials</b><br/>Using the native enterprise directory for authentication ensures that there is a built-in high level of assurance in the user identity established for subsequent access control.All Enterprise subscriptions are automatically associated with their enterprise directory (xxx.onmicrosoft.com) and users in the native directory are trusted for authentication to enterprise subscriptions.</td><td>High</td><td>Yes</td><td>No</td></tr><tr><td><b>Publish profile credentials must not be used for App Service deployment</b><br/>Publish profile of App Services contains deployment and FTP credentials. There are 2 risks with this. First, the credentials can get easily leaked during the various workflows involving the publish profile. Secondly, use of public profiles weakens auditability of deployment actions.</td><td>High</td><td>No</td><td>No</td></tr><tr><td><b>Trigger URL for the App Service Web Job must require authentication</b><br/>Scheduled WebJobs can be triggered by specific scheduled time or by triggered URL. WebJob triggered URL can be authenticated by AAD authentication (bearer token) or by App Services deployment credentials. Since its not recommended to use publish profiles, WebJob triggered URL must be authenticated by AAD authentication.</td><td>High</td><td>No</td><td>No</td></tr><tr><td><b>The webhook used for a Web Job must encrypt sensitive data in transit</b><br/>Use of HTTPS ensures server/service authentication and protects data in transit from network layer man-in-the-middle, eavesdropping, session-hijacking attacks.</td><td>High</td><td>No</td><td>No</td></tr><tr><td><b>All App Service secrets should be stored in Key Vault</b><br/>Keeping secrets such as DB connection strings, passwords, keys, etc. in clear text can lead to easy compromise at various avenues during an application's lifecycle. Storing them in a key vault ensures that they are protected at rest.</td><td>Medium</td><td>No</td><td>No</td></tr><tr><td><b>App Service should use Notification Hub for push notification (instead of directly using Push Notification Service)</b><br/>Notification Hub provides a better mechanism to manage the keys related Push Notification Systems (PNS).</td><td>Medium</td><td>No</td><td>No</td></tr><tr><td><b>Remote debugging must be turned off for App Service</b><br/>Remote debugging requires inbound ports to be opened on App Service. These ports become easy targets for compromise from various internet based attacks.</td><td>High</td><td>Yes</td><td>No</td></tr><tr><td><b>Web Sockets should be disabled for App Service</b><br/>WebSockets protocol (WS) is vulnerable to different types of security attacks. Usage of Web Sockets with in web applications has to be carefully reviewed.</td><td>Medium</td><td>Yes</td><td>Yes</td></tr><tr><td><b>'Always On' should be configured for App Service</b><br/>By default, websites are unloaded if they have been idle for some period of time. However, this may not be ideal for 'high availability' requirements. Configuring 'Always On' can help prevent app services from getting timed out.</td><td>Medium</td><td>Yes</td><td>No</td></tr><tr><td><b>The latest version of .NET framework version should be used for App Service</b><br/>Running on older .Net versions could mean you are not using latest security classes. Usage of such old classes and types can make your application vulnerable.</td><td>Low</td><td>Yes</td><td>Yes</td></tr><tr><td><b>Deployment of App Service should be done using ARM template</b><br/>Deployment using ARM template is more secure than using publish profiles. This is because the former uses user/SPN credentials which can be protected better than publish profiles and provide a better audit trail of deployment activity.</td><td>Medium</td><td>No</td><td>No</td></tr><tr><td><b>App Service must be deployed on a minimum of two instances to ensure availability</b><br/>App Service deployed on multiple instances ensures that the App Service remains available even if an instance is down.</td><td>Medium</td><td>Yes</td><td>Yes</td></tr><tr><td><b>Backup feature must be configured to backup data for App Service</b><br/>Enabling backup on App Service ensures that there is always a previous snapshot of App Service data that can be leveraged towards recovery scenarios.</td><td>Medium</td><td>Yes</td><td>No</td></tr><tr><td><b>Auditing and Monitoring must be enabled for App Service</b><br/>Auditing enables log collection of important system events pertinent to security. Regular monitoring of audit logs can help to detect any suspicious and malicious activity early and respond in a timely manner.</td><td>Medium</td><td>Yes</td><td>Yes</td></tr><tr><td><b>Auto healing should be configured for App Service</b><br/>With the use of Auto-Healing, a website can automatically recover from long running/blocked states. Auto-Healing enables automatic recycling of the worker process hosting your web application based on certain events. E.g. 1. When request count breaches a certain limit 2. When requests are running slower that expected 3. When an unexpected http status code is received X number of times 4. When the process consumes more than expected memory</td><td>Medium</td><td>No</td><td>No</td></tr><tr><td><b>App Service must only be accessible over HTTPS</b><br/>Use of HTTPS ensures server/service authentication and protects data in transit from network layer eavesdropping attacks.</td><td>High</td><td>Yes</td><td>No</td></tr><tr><td><b>WEBSITE_LOAD_CERTIFICATES parameter must not be set to '*' (i.e. all) for App Service</b><br/>Using '*' for this parameter means that all certificates will get uploaded to the VM running the website. This will most likely lead to abuse of the principle of least privilege as it is unlikely that the site needs access to all certificates at runtime.</td><td>High</td><td>Yes</td><td>No</td></tr><tr><td><b>Keys should be renewed after a regular interval</b><br/>Periodic key/password rotation is a good security hygiene practice as, over time, it minimizes the likelihood of data loss/compromise which can arise from key theft/brute forcing/recovery attacks.</td><td>Medium</td><td>No</td><td>No</td></tr><tr><td><b>Host key access should not be shared with individual clients</b><br/>Host Keys grant full access to all the functions within a function app. Not sharing this key with individual clients ensures that clients are granted just enough permissions to invoke a particular function</td><td>Medium</td><td>No</td><td>No</td></tr><tr><td><b>Authorization level for HTTP Trigger function in a function app should be set to 'Function'</b><br/>Use 'Function' authorization level to ensure that users with minimum of function keys should only be able to invoke the function. This is in accordance with the principle of least privilege.</td><td>Medium</td><td>Yes</td><td>No</td></tr><tr><td><b>Functions app edit mode should be set to Read Only</b><br/>Using 'Read Only' mode ensures that source code is changes come in via a CICD pipeline and not directly through portal. This ensures that code changes are properly audited.</td><td>Medium</td><td>Yes</td><td>No</td></tr><tr><td><b>Different functions keys must be generated and shared with individual clients.</b><br/>Different function keys for individual clients promotes separation of concerns. It also makes revocation easier to manage in the event of a compromise of one client.</td><td>Medium</td><td>No</td><td>No</td></tr><tr><td><b>Use Managed Service Identity (MSI) for accessing other AAD-protected resources from the app service.</b><br/>Managed Service Identity (MSI) allows your app to easily access other AAD-protected resources such as Azure Key Vault. The identity is managed by the Azure platform and eliminates the need to provision/manage/rotate any secrets thus reducing the overall risk.</td><td>Medium</td><td>Yes</td><td>No</td></tr><tr><td><b>Ensure that CORS access is granted to a limited set of trusted origins.</b><br/>CORS enables applications running under one domain to access a resource under another domain. Using '*' (allow all) for CORS setting means that an application running under any domain can have access to your application's resources and data. Restricting allowed origins to the specific set that needs access aligns with the principle of least privilege.</td><td>Medium</td><td>Yes</td><td>No</td></tr>
</table>
